
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Getting started &#8212; PyBerny 0.6.2.post15.dev0+37ca6ec documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/katex-math.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"></script>
    <script src="_static/katex_autorenderer.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Algorithm" href="algorithm.html" />
    <link rel="prev" title="PyBerny Documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyBerny</a></h1>



<p class="blurb">Molecular/crystal structure optimizer</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jhrmnn&repo=pyberny&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/jhrmnn/pyberny">
    <img
        alt="https://secure.travis-ci.org/jhrmnn/pyberny.svg?branch=master"
        src="https://secure.travis-ci.org/jhrmnn/pyberny.svg?branch=master"
    />
</a>
</p>




    

<p>
<a class="badge" href="https://codecov.io/github/jhrmnn/pyberny">
    <img
    alt="https://codecov.io/github/jhrmnn/pyberny/coverage.svg?branch=master"
    src="https://codecov.io/github/jhrmnn/pyberny/coverage.svg?branch=master"
    />
</a>
</p>
<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="algorithm.html">Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">PyBerny Documentation</a></li>
      <li>Next: <a href="algorithm.html" title="next chapter">Algorithm</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>Python &gt;=3.5 with Numpy.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The Python API consists of coroutine <a class="reference internal" href="api.html#berny.Berny" title="berny.Berny"><code class="xref py py-class docutils literal notranslate"><span class="pre">Berny</span></code></a> and function
<a class="reference internal" href="api.html#berny.optimize" title="berny.optimize"><code class="xref py py-func docutils literal notranslate"><span class="pre">optimize()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">berny</span> <span class="kn">import</span> <span class="n">Berny</span><span class="p">,</span> <span class="n">geomlib</span>
<span class="kn">from</span> <span class="nn">berny.solvers</span> <span class="kn">import</span> <span class="n">MopacSolver</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Berny</span><span class="p">(</span><span class="n">geomlib</span><span class="o">.</span><span class="n">readfile</span><span class="p">(</span><span class="s1">&#39;start.xyz&#39;</span><span class="p">))</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">MopacSolver</span><span class="p">()</span>
<span class="nb">next</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span>
<span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">optimizer</span><span class="p">:</span>
    <span class="n">energy</span><span class="p">,</span> <span class="n">gradients</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="nb">list</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span> <span class="n">geom</span><span class="o">.</span><span class="n">lattice</span><span class="p">))</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="n">energy</span><span class="p">,</span> <span class="n">gradients</span><span class="p">))</span>
<span class="n">relaxed</span> <span class="o">=</span> <span class="n">geom</span>
</pre></div>
</div>
<p>or equivalently:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">berny</span> <span class="kn">import</span> <span class="n">Berny</span><span class="p">,</span> <span class="n">geomlib</span><span class="p">,</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">berny.solvers</span> <span class="kn">import</span> <span class="n">MopacSolver</span>

<span class="n">relaxed</span> <span class="o">=</span> <span class="n">optimize</span><span class="p">(</span><span class="n">Berny</span><span class="p">(</span><span class="n">geomlib</span><span class="o">.</span><span class="n">readfile</span><span class="p">(</span><span class="s1">&#39;start.xyz&#39;</span><span class="p">)),</span> <span class="n">MopacSolver</span><span class="p">())</span>
</pre></div>
</div>
<p>A different option is to use the package via a command-line or socket
interface defined by the <code class="docutils literal notranslate"><span class="pre">berny</span></code> command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>usage: berny [-h] [--init] [-f {xyz,aims}] [-s host port] [paramfile]

positional arguments:
  paramfile             Optional optimization parameters as JSON

optional arguments:
  -h, --help            show this help message and exit
  --init                Initialize Berny optimizer.
  -f {xyz,aims}, --format {xyz,aims}
                        Format of geometry
  -s host port, --socket host port
                        Listen on given address
</pre></div>
</div>
<p>A call with <code class="docutils literal notranslate"><span class="pre">--init</span></code> corresponds to initializing the <a class="reference internal" href="api.html#berny.Berny" title="berny.Berny"><code class="xref py py-class docutils literal notranslate"><span class="pre">Berny</span></code></a>
object where the geometry is taken from standard input, assuming format
<code class="docutils literal notranslate"><span class="pre">--format</span></code>. The object is then pickled to <code class="docutils literal notranslate"><span class="pre">berny.pickle</span></code> and the program
quits. Subsequent calls to <code class="docutils literal notranslate"><span class="pre">berny</span></code> recover the <a class="reference internal" href="api.html#berny.Berny" title="berny.Berny"><code class="xref py py-class docutils literal notranslate"><span class="pre">Berny</span></code></a> object,
read energy and gradients from the standard input (first line is energy,
subsequent lines correspond to Cartesian gradients of individual atoms, all in
atomic units) and write the new structure estimate to standard output. An
example usage could look like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
berny --init params.json &lt;start.xyz
cat start.xyz &gt;current.xyz
<span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
    <span class="c1"># calculate energy and gradients of current.xyz</span>
    cat energy_gradients.txt <span class="p">|</span> berny &gt;next.xyz
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>  <span class="c1"># minimum reached</span>
        <span class="nb">break</span>
    <span class="k">fi</span>
    mv next.xyz current.xyz
<span class="k">done</span>
</pre></div>
</div>
<p>Alternatively, one can start an optimizer server with the <code class="docutils literal notranslate"><span class="pre">--socket</span></code>
option on a given address and port. This initiates the <a class="reference internal" href="api.html#berny.Berny" title="berny.Berny"><code class="xref py py-class docutils literal notranslate"><span class="pre">Berny</span></code></a>
object and waits for connections, in which it expects to receive energy and
gradients as a request (in the same format as above) and responds with a new
structure estimate in a given format. Example usage would be</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
berny -s localhost <span class="m">25000</span> -f xyz &lt;start.xyz <span class="p">&amp;</span>
cat start.xyz &gt;current.xyz
<span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
    <span class="c1"># calculate energy and gradients of current.xyz</span>
    cat energy_gradients.txt <span class="p">|</span> nc localhost <span class="m">25000</span> &gt;next.xyz
    <span class="k">if</span> <span class="o">[[</span> ! -s next.xyz <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>  <span class="c1"># minimum reached</span>
        <span class="nb">break</span>
    <span class="k">fi</span>
    mv next.xyz current.xyz
<span class="k">done</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2016-2021, Jan Hermann.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/getting-started.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>